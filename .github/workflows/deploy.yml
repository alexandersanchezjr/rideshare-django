name: "Deploy"

on: 
  push:
    branches:
      - master

jobs:
    deploy:
        runs-on: ubuntu-latest
    
        steps:
          - name: Checkout Repo
            uses: actions/checkout@v3
          - name: Docker Setup Buildx
            uses: docker/setup-buildx-action@v3.0.0

          - name: Docker Login
            uses: docker/login-action@v1
            with:
                username: ${{ secrets.DOCKER_USERNAME }}
                password: ${{ secrets.DOCKER_PASSWORD }}

          - name: Build and Push Docker Backend Image
            uses: docker/build-push-action@v5.0.0
            with:
              context: ./backend  # Context remains the same (current directory)
              file: ./backend/Dockerfile  # Dynamic Dockerfile path
              push: true  # Enable pushing the image
              tags: ${{ secrets.DOCKER_USERNAME }}/rideshare-backend:latest  # Separate tags for services

          - name: Build and Push Docker Frontend Image
            uses: docker/build-push-action@v5.0.0
            with:
              context: ./frontend  # Context remains the same (current directory)
              file: ./frontend/Dockerfile  # Dynamic Dockerfile path
              push: true  # Enable pushing the image
              tags: ${{ secrets.DOCKER_USERNAME }}/rideshare-frontend:latest  # Separate tags for services
              build-args: |
                HOSTNAME=${{ vars.HOSTNAME }}
                GOOGLE_MAPS_API_KEY=${{ secrets.GOOGLE_MAPS_API_KEY }}